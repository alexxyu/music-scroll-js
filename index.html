<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MusicScroll</title>

    <!--Import CSS-->
    <link rel="stylesheet" type="text/css" href="assets/main.css" />

    <!--Import Favicon-->
    <link rel="icon" sizes="16x16 32x32 64x64" href="assets/favicon.ico">
</head>
<body>
    <h1>MusicScroll</h1>

    <br>
    <input type="file" id="fileInput" name="file" accept="application/pdf"/></div>
    <div id="pageDisplay">
        <canvas id="canvas"></canvas>
    </div>
    <div id="changePage">
        <button id="previousPage">Previous</button>
        <button id="nextPage">Next</button>
    </div>

    <script async src="/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
    <script async src="https://unpkg.com/pdfjs-dist@latest/build/pdf.min.js"></script>
    <script type="text/javascript">
        
        function onOpenCvReady() {
            console.log('OpenCV.js is ready.');
        }

        function renderPage(page) {

            var canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            context.clearRect(0, 0, canvas.width, canvas.height);

            var scale = 1.0;
            var viewport = page.getViewport({scale: scale});

            // Prepare canvas using PDF page dimensions
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            // Render PDF page into canvas context
            var renderContext = {
                canvasContext: context,
                viewport: viewport
            };

            page.render(renderContext);
        }

        let imgElement = document.getElementById('imageSrc');
        let inputElement = document.getElementById('fileInput');
        
        inputElement.addEventListener('change', (e) => {
            
            pdfjsLib.getDocument(URL.createObjectURL(e.target.files[0])).promise.then(function(pdf) {

                const numPages = pdf.numPages;
                let currPage = 1

                // Render first page
                pdf.getPage(currPage).then(function(page) {
                    renderPage(page);
                    inputElement.remove();
                });

                let nextPageButton = document.getElementById('nextPage');
                let previousPageButton = document.getElementById('previousPage');
                nextPageButton.addEventListener('click', (e) => {
                    
                    if(currPage < numPages) {
                        currPage++;
                        pdf.getPage(currPage).then(function(page) {
                            renderPage(page);
                        });
                    }

                }, false);
                previousPageButton.addEventListener('click', (e) => {
                    
                    if(currPage > 1) {
                        currPage--;
                        pdf.getPage(currPage).then(function(page) {
                            renderPage(page);
                        });
                    }

                }, false);

            });

        }, false);
        
    </script>
</body>
</html>